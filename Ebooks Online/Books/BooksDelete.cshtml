@{
    Page.Title = "Boek verwijderen";
    Layout = "~/_BookListLayout.cshtml";

    var titel = "";
    int id;
    var db = Database.Open("StarterSite");
    var gebruiker = WebSecurity.CurrentUserName;
    List<int> selectedId = Session["selectListId"] as List<int>;
    int teller = selectedId.Count;

    if (WebSecurity.IsAuthenticated)
    {
        foreach (int i in selectedId)
        {
            if (!Request.QueryString["ID"].IsEmpty() && Request.QueryString["ID"].AsInt() > 0)
            {
                id = i;
                var command = "SELECT Books.Titel, Books.Id, Books.Gebruiker, UserProfile.UserId, UserProfile.Email FROM Books, UserProfile WHERE Books.Gebruiker = UserProfile.UserId AND Books.Id = @0 AND UserProfile.Email = @1";
                var row = db.QuerySingle(command, id, gebruiker);
                if (row != null)
                {
                    titel = row.Titel;
                }
                else
                {
                    Validation.AddFormError("Dit boek bestaat niet.");
                }
            }

            if (!Request.QueryString["ID"].IsEmpty() && Request.QueryString["ID"].AsInt() > 0 && IsPost)
            {
                id = i;
                var delete = "DELETE FROM Books WHERE Id = @0";
                db.Execute(delete, id);

                Response.Redirect("~/List.cshtml");
            }
        }
    }
    else
    {
        Validation.AddFormError("Je hebt hier geen rechten voor.");
        Response.Redirect("~/Default.cshtml");
    }
}

@Html.ValidationSummary()
<h2>Verwijderen</h2>
<p><a href="~/Books/BooksView.cshtml">Terug naar mijn boekenlijst</a></p>

<form method="post">
    <fieldset>
        <p>
            @for (int i = 0; i < teller; i++)
            {
                <span>Titel van het boek:</span>
                <span>@titel</span>
            }
        </p>
        <p><input type="submit" name="Delete" value="Verwijder dit boek"/></p>
    </fieldset>
</form>